{% extends "base.html" %}
{% block content %}
<div class="d-flex align-items-center mb-3">
	<h1 class="h4 m-0">Recent ideas</h1>
	<span class="ms-3 text-muted small">Showing {{ rows|length if rows else 0 }}</span>
	<div class="ms-auto small text-muted">Click a card to view full content</div>
</div>
{% if rows and rows|length > 0 %}
	<div class="row g-3">
		{% for r in rows %}
		<div class="col-12">
			<div class="card shadow-sm">
				<div class="card-body">
					<div class="d-flex justify-content-between align-items-start">
						<div>
							<h5 class="card-title mb-1">{{ (r.title or '').strip() or 'Untitled' }}</h5>
							<div class="text-muted small">{{ r.created_at or '' }}</div>
						</div>
						<div class="text-end">
							<div class="small text-muted">ID: <span class="select-all">{{ r.node_id }}</span>
								<span class="copy-btn ms-1" data-id="{{ r.node_id }}" title="Copy ID">ðŸ“‹</span>
							</div>
						</div>
					</div>
					{% set tag_str = (r.tags or '') %}
					{% if tag_str %}
					<div class="mt-2">
						{% for t in tag_str.split(',') if t.strip() %}
							<span class="badge rounded-pill badge-tag">{{ t.strip() }}</span>
						{% endfor %}
					</div>
					{% endif %}
					<div class="mt-2 text-truncate-4">{{ (r.content or '').strip() }}</div>
					<div class="mt-3">
						<button class="btn btn-sm btn-outline-primary view-btn" data-id="{{ r.node_id }}" data-title="{{ (r.title or '').strip() or 'Untitled' }}" data-content="{{ (r.content or '').strip()|replace('"','&quot;') }}" data-tags="{{ tag_str }}">View</button>
					</div>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>
{% else %}
	<div class="alert alert-info">No ideas yet. Try generating some on the Home page.</div>
{% endif %}

<!-- Modal -->
<div class="modal fade" id="ideaModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-lg modal-dialog-scrollable">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="ideaModalLabel">Idea</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div id="ideaTags" class="mb-2"></div>
				<pre id="ideaContent" class="mb-0" style="white-space: pre-wrap"></pre>
			</div>
			<div class="modal-footer">
				<button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
	</div>

<script>
	document.addEventListener('click', (e) => {
		if (e.target && e.target.classList.contains('copy-btn')){
			const id = e.target.getAttribute('data-id');
			navigator.clipboard.writeText(id).then(()=>{ e.target.textContent = 'âœ”'; setTimeout(()=> e.target.textContent='ðŸ“‹', 1200); });
		}
		if (e.target && e.target.classList.contains('view-btn')){
			const title = e.target.getAttribute('data-title') || 'Idea';
			const content = e.target.getAttribute('data-content') || '';
			const tags = (e.target.getAttribute('data-tags') || '').split(',').map(t=>t.trim()).filter(Boolean);
			document.getElementById('ideaModalLabel').textContent = title;
			const tagsEl = document.getElementById('ideaTags');
			tagsEl.innerHTML = '';
			tags.forEach(t=>{ const span = document.createElement('span'); span.className='badge rounded-pill badge-tag me-1'; span.textContent=t; tagsEl.appendChild(span); });
			document.getElementById('ideaContent').textContent = content;
			const modal = new bootstrap.Modal(document.getElementById('ideaModal'));
			modal.show();
		}
	});
</script>
{% endblock %}

